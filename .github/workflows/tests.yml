name: Tests

on:
  pull_request:
    branches:
      - master
      - main

jobs:
  build:

    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        python: ['3.9', '3.10', '3.11', '3.12', '3.13']
        os: [ubuntu-latest, macos-latest, windows-latest]
        java: ['11', '17', '21']  # Java version used by the validator project

    steps:
    - uses: actions/checkout@v4
    # Same Java version used by the validator project
    # https://github.com/validator/validator/blob/main/.github/workflows/build.yml#L39-L42
    - uses: actions/setup-java@v4
      with:
        distribution: 'zulu'
        java-version: ${{ matrix.java }}

    - name: Set up Python ${{ matrix.python }}
      uses: actions/setup-python@v5
      with:
        python-version: ${{ matrix.python }}

    - name: Install uv
      uses: astral-sh/setup-uv@v6
      with:
        enable-cache: true

    - name: Install the project
      run: |
        uv sync --locked --all-extras --dev
        uv pip install .

    - name: Print environment
      run: |
        python -m pip freeze
        python --version
        python -c "import html5validator; print(html5validator.__version__)"

    - name: Run Lint
      run: | 
        uv run ruff check .
        uv run ruff format --check --diff .

    - name: Test
      env:
        PYTHONDEVMODE: 1
      run: uv run pytest -vv
